#!/bin/sh

# ============================================================
#  تحذير: هذا السكريبت سيقوم بحذف جميع إعدادات OpenPLi الخاصة بك
#  وسيؤدي إلى إعادة ضبط المصنع للصورة.
#  استخدمه على مسؤوليتك الكاملة. لا يمكن التراجع عن العملية.
# ============================================================

# رسالة تحذير أخيرة قبل البدء
echo "************************************************************"
echo "* تحذير شديد! أنت على وشك حذف جميع إعدادات OpenPLi      *"
echo "* وإعادة ضبط المصنع. هذا سيحذف القنوات والإضافات وكل شيء. *"
echo "* اضغط CTRL+C الآن للإلغاء إذا لم تكن متأكدًا.           *"
echo "* سيستمر السكريبت تلقائيًا خلال 10 ثوانٍ...              *"
echo "************************************************************"
sleep 10

# إيقاف واجهة Enigma2
echo "[*] يتم الآن إيقاف واجهة Enigma2 (init 4)..."
init 4
sleep 5 # انتظر قليلاً للتأكد من توقفها

# حذف محتويات مجلد إعدادات Enigma2
# هذا هو الجزء الرئيسي الذي يقوم بإعادة الضبط
echo "[*] يتم الآن حذف محتويات مجلد الإعدادات /etc/enigma2/ ..."
# تأكد من عدم حذف المجلد نفسه، فقط محتوياته
rm -rf /etc/enigma2/*
echo "[*] تم حذف محتويات /etc/enigma2/."

# قد تحتاج أيضًا لحذف إعدادات أخرى مثل إعدادات السوفتكام إذا أردت إعادة ضبط كاملة أكثر
# على سبيل المثال، لإعدادات OSCam (إذا كنت تستخدمه وموجود في المسار الافتراضي):
# echo "[*] محاولة حذف إعدادات OSCam من /etc/tuxbox/config/oscam-stable/ ..."
# rm -rf /etc/tuxbox/config/oscam-stable/*
# قم بإزالة علامة التعليق (#) من السطرين السابقين إذا أردت حذف إعدادات OSCam أيضًا - كن حذرًا!

# مزامنة التغييرات مع نظام الملفات
echo "[*] مزامنة التغييرات مع نظام الملفات..."
sync
sync

# إعادة تشغيل الجهاز لتطبيق التغييرات والبدء من جديد
echo "[*] سيتم الآن إعادة تشغيل الجهاز (reboot)..."
echo "[*] بعد إعادة التشغيل، ستبدأ الصورة في حالة الإعداد الافتراضي."
reboot

exit 0
